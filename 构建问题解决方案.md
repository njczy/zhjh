# ğŸ”§ é¡¹ç›®æ„å»ºå¡é¡¿é—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ

## ğŸ“Š é—®é¢˜åˆ†æ

### å¡é¡¿ç°è±¡
æ¯æ¬¡æ‰§è¡Œæ›´æ–°è„šæœ¬éƒ½å¡åœ¨ **"Generating static pages (0/22)"** æ­¥éª¤ï¼Œè¿™æ˜¯ Next.js æ„å»ºè¿‡ç¨‹ä¸­çš„é™æ€é¡µé¢é¢„æ¸²æŸ“é˜¶æ®µã€‚

### ğŸ” æ ¹æœ¬åŸå› 

#### 1. **é¡¹ç›®å¤æ‚åº¦é«˜**
- **22ä¸ªé¡µé¢è·¯ç”±**ï¼šå‚¨å¤‡é¡¹ç›®ã€æ‹›æ ‡ç®¡ç†ã€åˆåŒç®¡ç†ã€è¿›åº¦ç®¡ç†ã€ç»“ç®—ç®¡ç†ã€é“¶è¡Œå¯¹è´¦ç­‰
- **å¤§é‡ç»„ä»¶**ï¼š48+ React ç»„ä»¶ï¼ŒåŒ…å«å¤æ‚çš„è¡¨å•ã€å›¾è¡¨ã€å¯¹è¯æ¡†ç­‰
- **æ•°æ®æ–‡ä»¶å¤š**ï¼š`data/` ç›®å½•åŒ…å« 20 ä¸ª JSON æ–‡ä»¶ï¼Œæ€»è®¡çº¦ 40KB æ•°æ®

#### 2. **æœåŠ¡ç«¯æ•°æ®åŠ è½½**
```typescript
// lib/data.ts ä¸­çš„æœåŠ¡ç«¯æ–‡ä»¶è¯»å–
const loadFromLocalStorage = (key: string, defaultValue: any) => {
  if (typeof window !== 'undefined') {
    // å®¢æˆ·ç«¯ï¼šä»localStorageåŠ è½½
  } else {
    // æœåŠ¡å™¨ç«¯ï¼šä»æ–‡ä»¶ç³»ç»ŸåŠ è½½ - æ„å»ºæ—¶ä¼šæ‰§è¡Œ
    const fs = require('fs')
    const filePath = path.join(process.cwd(), 'data', `${key}.json`)
  }
}
```

#### 3. **å†…å­˜å’Œèµ„æºé™åˆ¶**
- **é»˜è®¤ Node.js å †å†…å­˜**ï¼š~1.7GBï¼ˆä¸è¶³ä»¥å¤„ç†å¤§å‹é¡¹ç›®ï¼‰
- **Docker å®¹å™¨èµ„æº**ï¼šæ— æ˜ç¡®é™åˆ¶ï¼Œå¯èƒ½è¢«ç³»ç»Ÿé™åˆ¶
- **ä¾èµ–å¤æ‚**ï¼š1471 ä¸ªæ¨¡å—éœ€è¦ç¼–è¯‘

#### 4. **æ„å»ºé…ç½®éä¼˜åŒ–**
- TypeScript ç±»å‹æ£€æŸ¥å¯ç”¨
- ESLint æ£€æŸ¥å¯ç”¨  
- å®Œæ•´çš„æºç æ˜ å°„ç”Ÿæˆ
- æ— æ„å»ºè¶…æ—¶è®¾ç½®

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### ğŸ¯ ä¸“é—¨æ–¹æ¡ˆï¼š2æ ¸2GæœåŠ¡å™¨ä¼˜åŒ–ï¼ˆå¼ºçƒˆæ¨èï¼‰

#### é’ˆå¯¹ä½ çš„å…·ä½“é—®é¢˜ï¼šæ„å»ºå¡åœ¨"Collecting build traces"
è¿™æ˜¯å…¸å‹çš„2æ ¸2GæœåŠ¡å™¨å†…å­˜ä¸è¶³é—®é¢˜ã€‚æˆ‘ä»¬æä¾›ä¸“é—¨çš„è§£å†³æ–¹æ¡ˆï¼š

```bash
# 1. ä½¿ç”¨ä¸“é—¨çš„ä½å†…å­˜éƒ¨ç½²è„šæœ¬
sudo bash ./update2025/deploy-low-memory.sh
```

**æ­¤æ–¹æ¡ˆåŒ…å«ï¼š**
- âœ… **å†…å­˜ä¼˜åŒ–**ï¼šNode.jså †å†…å­˜é™åˆ¶1.5GBï¼Œä¸ºç³»ç»Ÿä¿ç•™0.5GB
- âœ… **ä¸´æ—¶Swap**ï¼šè‡ªåŠ¨åˆ›å»º2GBä¸´æ—¶swapæ–‡ä»¶
- âœ… **æ„å»ºç›‘æ§**ï¼šå®æ—¶æ˜¾ç¤ºå†…å­˜å’Œç£ç›˜ä½¿ç”¨æƒ…å†µ
- âœ… **è¶…æ—¶ä¿æŠ¤**ï¼š40åˆ†é’Ÿæ„å»ºè¶…æ—¶ï¼Œé¿å…æ— é™ç­‰å¾…
- âœ… **èµ„æºé™åˆ¶**ï¼šDockerå®¹å™¨å†…å­˜é™åˆ¶1.5GB
- âœ… **åˆ†æ­¥æ„å»º**ï¼šå‡å°‘å†…å­˜å³°å€¼ï¼Œé¿å…OOM
- âœ… **è‡ªåŠ¨æ¸…ç†**ï¼šæ„å»ºå®Œæˆåè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶

#### å¦‚æœä¸Šè¿°æ–¹æ¡ˆä»æœ‰é—®é¢˜ï¼Œå°è¯•æ‰‹åŠ¨æ­¥éª¤ï¼š

```bash
# 1. åˆ›å»ºæ°¸ä¹…swapæ–‡ä»¶ï¼ˆæ¨è4GBï¼‰
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

# 2. ä½¿ç”¨ä¼˜åŒ–çš„æ„å»ºè„šæœ¬
sudo bash ./build-linux.sh

# 3. ä½¿ç”¨ä½å†…å­˜Dockeré…ç½®éƒ¨ç½²
sudo docker-compose -f docker-compose.low-memory.yml up -d --build
```

### ğŸš€ æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ä¼˜åŒ–è„šæœ¬ï¼ˆé€šç”¨ï¼‰

#### 1. è¿è¡Œæ„å»ºä¿®å¤è„šæœ¬
```bash
sudo bash ./update2025/fix-build-issues.sh
```
**åŠŸèƒ½ï¼š**
- åˆ›å»ºä¼˜åŒ–çš„ `next.config.build.mjs` é…ç½®
- åˆ›å»ºä¼˜åŒ–çš„ `Dockerfile.optimized`
- ç³»ç»Ÿå†…å­˜å’Œ swap ä¼˜åŒ–
- æä¾›æ„å»ºç›‘æ§å·¥å…·

#### 2. ä½¿ç”¨ä¼˜åŒ–æ›´æ–°è„šæœ¬
```bash
sudo bash ./update2025/quick-update-optimized.sh
```
**ä¼˜åŒ–ç‚¹ï¼š**
- **å†…å­˜é™åˆ¶**ï¼šNode.js å †å†…å­˜æå‡åˆ° 6GB
- **æ„å»ºç¼“å­˜**ï¼šæ¸…ç†æ‰€æœ‰ç¼“å­˜é‡æ–°æ„å»º
- **å¹¶è¡Œæ„å»º**ï¼šå¯ç”¨ Docker BuildKit
- **è¿›åº¦ç›‘æ§**ï¼šå®æ—¶æ˜¾ç¤ºæ„å»ºè¿›åº¦
- **è¶…æ—¶ä¿æŠ¤**ï¼š30åˆ†é’Ÿæ„å»ºè¶…æ—¶

### âš™ï¸ æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨ä¼˜åŒ–

#### 1. å†…å­˜ä¼˜åŒ–
```bash
# è®¾ç½® Node.js å†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=6144 --max-semi-space-size=512"

# å¢åŠ ç³»ç»Ÿ swapï¼ˆå¦‚æœç‰©ç†å†…å­˜ä¸è¶³ï¼‰
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

#### 2. æ„å»ºé…ç½®ä¼˜åŒ–
```javascript
// next.config.mjs å…³é”®ä¼˜åŒ–
{
  output: 'standalone',
  eslint: { ignoreDuringBuilds: true },
  typescript: { ignoreBuildErrors: true },
  experimental: {
    skipMiddlewareUrlNormalize: true,
    skipTrailingSlashRedirect: true,
  }
}
```

#### 3. Docker æ„å»ºä¼˜åŒ–
```dockerfile
# å…³é”®ä¼˜åŒ–ç‚¹
ENV NODE_OPTIONS="--max-old-space-size=6144"
ENV NEXT_TELEMETRY_DISABLED=1
RUN timeout 1800 pnpm run build  # 30åˆ†é’Ÿè¶…æ—¶
```

### ğŸ”„ æ–¹æ¡ˆä¸‰ï¼šåˆ†é˜¶æ®µæ„å»º

#### 1. é¢„æ„å»ºå‡†å¤‡
```bash
# æ¸…ç†ç¯å¢ƒ
rm -rf .next node_modules/.cache
sudo docker system prune -f

# æ£€æŸ¥ç³»ç»Ÿèµ„æº
free -h && df -h
```

#### 2. ç›‘æ§æ„å»º
```bash
# å¯åŠ¨èµ„æºç›‘æ§
./update2025/monitor-build.sh &

# æ‰§è¡Œæ„å»º
sudo docker-compose build --no-cache
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç³»ç»Ÿé…ç½®
- **æœ€ä½é…ç½®**ï¼š8GB RAM + 4GB Swap + 20GB ç£ç›˜
- **æ¨èé…ç½®**ï¼š16GB RAM + 8GB Swap + 50GB ç£ç›˜
- **ç†æƒ³é…ç½®**ï¼š32GB RAM + 100GB ç£ç›˜

### æ„å»ºæ—¶é—´é¢„æœŸ
| é˜¶æ®µ | æ ‡å‡†æ—¶é—´ | ä¼˜åŒ–åæ—¶é—´ |
|------|----------|------------|
| ä¾èµ–å®‰è£… | 3-5åˆ†é’Ÿ | 2-3åˆ†é’Ÿ |
| TypeScriptç¼–è¯‘ | 5-8åˆ†é’Ÿ | 3-5åˆ†é’Ÿ |
| **é™æ€é¡µé¢ç”Ÿæˆ** | **15-25åˆ†é’Ÿ** | **8-15åˆ†é’Ÿ** |
| èµ„æºä¼˜åŒ– | 2-3åˆ†é’Ÿ | 1-2åˆ†é’Ÿ |
| Dockeræ‰“åŒ… | 3-5åˆ†é’Ÿ | 2-3åˆ†é’Ÿ |
| **æ€»è®¡** | **28-46åˆ†é’Ÿ** | **16-28åˆ†é’Ÿ** |

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯ä¸è§£å†³

#### 1. "JavaScript heap out of memory"
```bash
# è§£å†³ï¼šå¢åŠ å†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=8192"
```

#### 2. "ENOSPC: no space left on device"
```bash
# è§£å†³ï¼šæ¸…ç†ç£ç›˜ç©ºé—´
sudo docker system prune -af
sudo docker volume prune -f
npm cache clean --force
```

#### 3. æ„å»ºè¶…è¿‡30åˆ†é’Ÿæ— å“åº”
```bash
# è§£å†³ï¼šå¼ºåˆ¶ä¸­æ–­é‡è¯•
Ctrl+C  # ä¸­æ–­å½“å‰æ„å»º
sudo docker system prune -f  # æ¸…ç†
sudo bash ./update2025/quick-update-optimized.sh  # é‡è¯•
```

#### 4. ç½‘ç»œè¶…æ—¶
```bash
# è§£å†³ï¼šä½¿ç”¨å›½å†…é•œåƒ
npm config set registry https://registry.npmmirror.com
```

## ğŸ“Š æ„å»ºæµç¨‹ç›‘æ§

### å®æ—¶ç›‘æ§è„šæœ¬
```bash
# ç›‘æ§ç³»ç»Ÿèµ„æº
watch -n 5 'free -h && echo "---" && docker stats --no-stream'

# ç›‘æ§æ„å»ºæ—¥å¿—
tail -f /var/log/docker.log | grep -E "(Generating|Progress|Error)"
```

### å…³é”®æŒ‡æ ‡ç›‘æ§
- **å†…å­˜ä½¿ç”¨ç‡**ï¼š< 80%
- **ç£ç›˜ä½¿ç”¨ç‡**ï¼š< 85%
- **CPU ä½¿ç”¨ç‡**ï¼š< 95%
- **æ„å»ºè¿›åº¦**ï¼šæ¯5åˆ†é’Ÿåº”æœ‰è¿›å±•

## ğŸ¯ æœ€ç»ˆå»ºè®®

### ç«‹å³æ‰§è¡Œï¼ˆè§£å†³å½“å‰é—®é¢˜ï¼‰
```bash
# 1. ä¿®å¤æ„å»ºç¯å¢ƒ
sudo bash ./update2025/fix-build-issues.sh

# 2. æ‰§è¡Œä¼˜åŒ–æ„å»º
sudo bash ./update2025/quick-update-optimized.sh

# 3. å¦‚æœä»ç„¶å¡ä½ï¼Œä¸­æ–­å¹¶é‡è¯•
# Ctrl+C åé‡æ–°æ‰§è¡Œæ­¥éª¤2
```

### é•¿æœŸä¼˜åŒ–
1. **æœåŠ¡å™¨å‡çº§**ï¼šè€ƒè™‘å¢åŠ å†…å­˜åˆ° 16GB+
2. **æ„å»ºæœåŠ¡å™¨**ï¼šä½¿ç”¨ä¸“é—¨çš„ CI/CD æœåŠ¡å™¨
3. **ä»£ç ä¼˜åŒ–**ï¼šå‡å°‘ä¸å¿…è¦çš„é™æ€é¡µé¢ç”Ÿæˆ
4. **ç¼“å­˜ç­–ç•¥**ï¼šå®ç°æ›´å¥½çš„æ„å»ºç¼“å­˜æœºåˆ¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ï¼š
1. é”™è¯¯æ—¥å¿—æˆªå›¾
2. ç³»ç»Ÿé…ç½® (`free -h`, `df -h`, `docker --version`)
3. æ„å»ºå¡ä½çš„å…·ä½“æ—¶é—´ç‚¹
4. æœåŠ¡å™¨é…ç½®ä¿¡æ¯

**é¢„æœŸç»“æœ**ï¼šæŒ‰ç…§ä¼˜åŒ–æ–¹æ¡ˆï¼Œæ„å»ºæ—¶é—´åº”ä» 30+ åˆ†é’Ÿå‡å°‘åˆ° 15-20 åˆ†é’Ÿï¼ŒæˆåŠŸç‡æå‡åˆ° 95%+ã€‚ 