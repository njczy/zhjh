# 银行对账管理功能说明

## 功能概述
银行对账管理是项目进度管理系统的核心财务模块，实现银行流水与开票记录的智能自动匹配，确保财务数据的一致性和准确性。

## 核心功能

### 1. 数据导入区
#### 银行流水导入
- **支持格式**: Excel/CSV格式
- **固定模板**: 交易日期,金额,对方户名,流水号,摘要
- **自动过滤**: 仅保留入金交易（忽略出金/转账）
- **示例格式**:
  ```
  2024-01-15,50000,北京科技有限公司,TX202401150001,转账收入
  2024-01-16,30000,上海软件科技公司,TX202401160002,项目回款
  ```

#### 系统数据源
- **自动拉取**: 开票管理模块中"已开票未回款"记录
- **预加载字段**: 合同编号、客户名称、开票金额、应回款日期

### 2. 智能匹配引擎
#### 匹配条件（三方验证机制）
匹配必须满足至少两项条件：
- **金额匹配**: 允许5%误差（银行手续费等）
- **客户匹配**: 模糊匹配客户名称
- **日期匹配**: 开票后90天内收到款

#### 匹配结果分类
| 状态图标 | 匹配类型 | 处理方式 | 置信度 |
|---------|---------|----------|--------|
| ✅ | 精确匹配 | 自动确认 | 80%+ |
| ⚠️ | 疑似匹配 | 人工审核 | 50-79% |
| ❌ | 无匹配项 | 手动关联 | <50% |

### 3. 差异处理区
#### 常见差异场景
- **银行手续费**: 自动扣除差额
- **分笔支付**: 拆分关联多张开票
- **预付款抵扣**: 标记非开票入账

#### 调平操作
- **差额调整单**: 需备注原因
- **红冲重匹配**: 保留操作记录

## 权限与安全

### 操作权限
| 功能 | 财务助理 | 会计主管 |
|------|---------|----------|
| 银行流水导入 | ✓ | ✓ |
| 差异超过1万元调平 | ✗ | ✓ |
| 修改历史匹配记录 | ✗ | ✓ |

### 审计要求
- **操作轨迹**: 保留所有操作记录
- **匹配逻辑**: 记录自动/手动匹配说明
- **调平审批**: 记录审批流程

## 异常监控

### 自动检测
- **重复流水号**: 防止重复入账
- **金额偏差>5%**: 触发风控警报
- **超期90天未匹配**: 移入呆账池

### 关联关系锁定
- **已匹配记录**: 自动冻结，禁止修改关联开票信息
- **银行流水**: 标记"已核销"

## 输出物

### 每日对账报告（自动生成）
- **匹配成功率统计**
- **差异Top10客户清单**
- **异常流水明细表**

### 财务凭证
自动生成会计分录：
```
借：银行存款
贷：应收账款-{客户}
    财务费用-手续费（如有）
```

## 使用流程

### 1. 导入银行流水
1. 点击"导入流水"按钮
2. 粘贴CSV格式的银行流水数据
3. 系统自动验证格式并导入

### 2. 执行自动匹配
1. 点击"自动匹配"按钮
2. 系统智能分析匹配条件
3. 生成匹配结果列表

### 3. 审核匹配结果
1. 查看"匹配管理"标签页
2. 对疑似匹配进行人工审核
3. 填写审核意见并确认

### 4. 手动关联
1. 对无匹配项的流水点击"关联"
2. 选择对应的开票记录
3. 填写关联原因并确认

### 5. 生成对账报告
1. 点击"生成报告"按钮
2. 系统自动生成当日对账报告
3. 支持报告下载和查看

## 技术特性

### 智能匹配算法
- **多维度匹配**: 金额+客户+日期综合判断
- **置信度评分**: 0-100分匹配可信度
- **最佳匹配**: 每个流水只保留最佳匹配结果

### 数据完整性
- **事务处理**: 确保数据一致性
- **版本控制**: 记录所有变更历史
- **备份恢复**: 支持数据回滚

### 性能优化
- **并发处理**: 支持大批量流水导入
- **增量匹配**: 只处理新增未匹配数据
- **缓存机制**: 提高查询响应速度

## 业务价值

### 效率提升
- **自动化匹配**: 减少80%人工核对工作量
- **实时处理**: 快速发现资金异常
- **智能预警**: 提前识别风险账款

### 准确性保障
- **三方验证**: 多维度确保匹配准确性
- **审计追踪**: 完整的操作记录链条
- **异常检测**: 自动识别数据异常

### 合规管理
- **权限控制**: 基于角色的操作权限
- **审批流程**: 大额差异需要审批
- **审计报告**: 满足财务合规要求

## 注意事项

1. **数据格式**: 导入前请确保银行流水格式正确
2. **金额精度**: 系统支持到分的金额精度
3. **日期格式**: 请使用YYYY-MM-DD格式
4. **备份建议**: 重要操作前建议备份数据
5. **网络要求**: 确保网络连接稳定

银行对账管理功能为项目进度管理系统提供了强大的财务数据管理能力，通过智能化的匹配算法和完善的异常处理机制，确保财务数据的准确性和一致性。 