# é¡¹ç›®æ›´æ–°éƒ¨ç½²æ•™ç¨‹

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [å¼€å‘ç¯å¢ƒé…ç½®](#å¼€å‘ç¯å¢ƒé…ç½®)
3. [æœ¬åœ°å¼€å‘æµç¨‹](#æœ¬åœ°å¼€å‘æµç¨‹)
4. [æœåŠ¡å™¨éƒ¨ç½²æ›´æ–°](#æœåŠ¡å™¨éƒ¨ç½²æ›´æ–°)
5. [å¸¸è§é—®é¢˜è§£å†³](#å¸¸è§é—®é¢˜è§£å†³)
6. [ç®¡ç†å‘½ä»¤å‚è€ƒ](#ç®¡ç†å‘½ä»¤å‚è€ƒ)

---

## ğŸš€ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ä¿¡æ¯
- **é¡¹ç›®åç§°**: é¡¹ç›®ç®¡ç†ç³»ç»Ÿ (zhjh)
- **æŠ€æœ¯æ ˆ**: Next.js 15 + React 19 + TypeScript
- **éƒ¨ç½²æ–¹å¼**: Docker + Docker Compose
- **å¼€å‘ç¯å¢ƒ**: Windows 11
- **ç”Ÿäº§ç¯å¢ƒ**: äº¬ä¸œäº‘ Ubuntu 22.04

### é¡¹ç›®ç»“æ„
```
zhjh/
â”œâ”€â”€ app/                    # Next.js App Router
â”œâ”€â”€ components/             # React ç»„ä»¶
â”œâ”€â”€ lib/                    # å·¥å…·å‡½æ•°å’Œæ•°æ®
â”œâ”€â”€ data/                   # æ•°æ®æ–‡ä»¶
â”œâ”€â”€ update2025/             # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ Dockerfile              # Docker æ„å»ºæ–‡ä»¶
â”œâ”€â”€ docker-compose.yml      # Docker Compose é…ç½®
â”œâ”€â”€ next.config.mjs         # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ next.config.dev.mjs     # å¼€å‘ç¯å¢ƒé…ç½®
â””â”€â”€ package.json            # é¡¹ç›®ä¾èµ–
```

---

## ğŸ’» å¼€å‘ç¯å¢ƒé…ç½®

### 1. ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Windows 10/11 æˆ– Linux
- **Node.js**: 20.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **åŒ…ç®¡ç†å™¨**: pnpm (æ¨è) æˆ– npm
- **Git**: æœ€æ–°ç‰ˆæœ¬

### 2. å¼€å‘å·¥å…·å®‰è£…

#### å®‰è£… Node.js
```bash
# ä¸‹è½½å¹¶å®‰è£… Node.js 20.x
# è®¿é—® https://nodejs.org/ ä¸‹è½½å®‰è£…åŒ…
```

#### å®‰è£… pnpm
```bash
npm install -g pnpm
```

#### å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/njczy/zhjh.git
cd zhjh
```

#### å®‰è£…ä¾èµ–
```bash
pnpm install
```

### 3. ç¯å¢ƒé…ç½®

#### Windows å¼€å‘ç¯å¢ƒç‰¹æ®Šé…ç½®
ç”±äº Windows ç¬¦å·é“¾æ¥æƒé™é™åˆ¶ï¼Œä½¿ç”¨ä¸“é—¨çš„å¼€å‘é…ç½®ï¼š

```bash
# å¼€å‘ç¯å¢ƒå¯åŠ¨
pnpm run dev

# Windows ä¸“ç”¨æ„å»ºï¼ˆé¿å…ç¬¦å·é“¾æ¥é—®é¢˜ï¼‰
pnpm run build:win
```

---

## ğŸ”§ æœ¬åœ°å¼€å‘æµç¨‹

### 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
# æ ‡å‡†å¯åŠ¨ï¼ˆæ¨èï¼‰
pnpm run dev

# Windows ä¸“ç”¨å¯åŠ¨ï¼ˆå¦‚é‡åˆ°æƒé™é—®é¢˜ï¼‰
pnpm run dev:win
```

### 2. å¼€å‘è§„èŒƒ

#### ä»£ç æäº¤è§„èŒƒ
```bash
# 1. æ·»åŠ æ›´æ”¹
git add .

# 2. æäº¤æ›´æ”¹ï¼ˆä½¿ç”¨è§„èŒƒçš„æäº¤ä¿¡æ¯ï¼‰
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"
# æˆ–
git commit -m "fix: ä¿®å¤bug"
# æˆ–
git commit -m "docs: æ›´æ–°æ–‡æ¡£"

# 3. æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push origin main
```

#### æäº¤ä¿¡æ¯ç±»å‹
- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–å·¥å…·å˜åŠ¨

### 3. æœ¬åœ°æµ‹è¯•

#### åŠŸèƒ½æµ‹è¯•
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm run dev

# è®¿é—® http://localhost:3000
# æµ‹è¯•å„ä¸ªåŠŸèƒ½æ¨¡å—ï¼š
# - å¾…åŠäº‹é¡¹ç®¡ç†
# - å‚¨å¤‡é¡¹ç›®ç®¡ç†
# - æœˆåº¦å®¡æ ¸æµç¨‹
```

#### æ„å»ºæµ‹è¯•
```bash
# Windows ç¯å¢ƒæ„å»ºæµ‹è¯•
pnpm run build:win

# ç”Ÿäº§ç¯å¢ƒæ„å»ºæµ‹è¯•
pnpm run build:docker
```

---

## ğŸŒ æœåŠ¡å™¨éƒ¨ç½²æ›´æ–°

### 1. é¦–æ¬¡éƒ¨ç½²å‡†å¤‡

#### æœåŠ¡å™¨ç¯å¢ƒè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 22.04 LTS
- **Docker**: æœ€æ–°ç‰ˆæœ¬
- **Docker Compose**: æœ€æ–°ç‰ˆæœ¬
- **Git**: æœ€æ–°ç‰ˆæœ¬

#### ç¯å¢ƒå®‰è£…è„šæœ¬
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y git curl wget

# å®‰è£… Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£… Docker Compose
sudo apt install -y docker-compose-plugin

# éªŒè¯å®‰è£…
docker --version
docker compose version
```

#### é…ç½® Docker å›½å†…é•œåƒæº
```bash
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://docker.m.daocloud.io"]
}
EOF

sudo systemctl daemon-reload
sudo systemctl restart docker
```

### 2. SSH é…ç½®ï¼ˆæ¨èï¼‰

#### ç”Ÿæˆ SSH å¯†é’¥
```bash
# åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆ SSH å¯†é’¥
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_rsa.pub
```

#### åœ¨ GitHub æ·»åŠ  Deploy Key
1. å¤åˆ¶ä¸Šé¢çš„å…¬é’¥å†…å®¹
2. è®¿é—® GitHub ä»“åº“ â†’ Settings â†’ Deploy keys
3. ç‚¹å‡» "Add deploy key"
4. ç²˜è´´å…¬é’¥ï¼Œå‹¾é€‰ "Allow write access"
5. ä¿å­˜

#### å…‹éš†é¡¹ç›®
```bash
# ä½¿ç”¨ SSH å…‹éš†ï¼ˆæ¨èï¼‰
git clone git@github.com:njczy/zhjh.git
cd zhjh

# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x update2025/*.sh
```

### 3. æ›´æ–°éƒ¨ç½²æ–¹å¼

#### æ–¹å¼ä¸€ï¼šå®Œæ•´æ›´æ–°ï¼ˆé¦–æ¬¡éƒ¨ç½²æˆ–é‡å¤§æ›´æ–°ï¼‰
```bash
cd /path/to/zhjh
./update2025/update.sh
```

**ç‰¹ç‚¹**ï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹ Git åè®®ï¼ˆSSH/HTTPSï¼‰
- âœ… æ™ºèƒ½ç½‘ç»œè¿æ¥æ£€æµ‹å’Œå¤‡ç”¨æ–¹æ¡ˆ
- âœ… å®Œæ•´çš„ Docker æ„å»ºå’Œéƒ¨ç½²æµç¨‹
- âœ… é”™è¯¯å¤„ç†å’ŒçŠ¶æ€æ£€æŸ¥
- âœ… è‡ªåŠ¨æ¸…ç† Docker èµ„æº

#### æ–¹å¼äºŒï¼šå¿«é€Ÿæ›´æ–°ï¼ˆæ—¥å¸¸å¼€å‘æ¨èï¼‰
```bash
cd /path/to/zhjh
./update2025/quick-update.sh
```

**ç‰¹ç‚¹**ï¼š
- âš¡ ç®€åŒ–æµç¨‹ï¼Œæœ€å°åŒ–åœæœºæ—¶é—´
- ğŸš€ å¿«é€Ÿæ‹‰å–ä»£ç å¹¶é‡æ–°éƒ¨ç½²
- ğŸ“Š åŸºæœ¬çŠ¶æ€æ£€æŸ¥

#### æ–¹å¼ä¸‰ï¼šæ‰‹åŠ¨æ›´æ–°ï¼ˆå®Œå…¨æ§åˆ¶ï¼‰
```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/zhjh

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 3. åœæ­¢ç°æœ‰æœåŠ¡
docker-compose down

# 4. é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# 5. æŸ¥çœ‹çŠ¶æ€
docker-compose ps
docker-compose logs -f app
```

### 4. æ›´æ–°æµç¨‹æœ€ä½³å®è·µ

#### æ ‡å‡†æ›´æ–°æµç¨‹
```bash
# 1. æœ¬åœ°å¼€å‘å®Œæˆ
git add .
git commit -m "feat: æ–°åŠŸèƒ½æè¿°"
git push origin main

# 2. æœåŠ¡å™¨æ›´æ–°ï¼ˆé€‰æ‹©å…¶ä¸­ä¸€ç§ï¼‰
# å¿«é€Ÿæ›´æ–°ï¼ˆæ¨èæ—¥å¸¸ä½¿ç”¨ï¼‰
./update2025/quick-update.sh

# æˆ–å®Œæ•´æ›´æ–°ï¼ˆé‡å¤§æ›´æ–°æ—¶ä½¿ç”¨ï¼‰
./update2025/update.sh
```

#### æ›´æ–°å‰æ£€æŸ¥æ¸…å•
- [ ] æœ¬åœ°åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å·²æäº¤åˆ° GitHub
- [ ] æœåŠ¡å™¨ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] å¤‡ä»½é‡è¦æ•°æ®ï¼ˆå¦‚éœ€è¦ï¼‰

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³

### 1. Windows å¼€å‘ç¯å¢ƒé—®é¢˜

#### ç¬¦å·é“¾æ¥æƒé™é”™è¯¯
```
Error: EPERM: operation not permitted, symlink
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ä½¿ç”¨ Windows ä¸“ç”¨å‘½ä»¤
pnpm run dev:win
pnpm run build:win

# æˆ–ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ PowerShell
```

#### å¯ç”¨ Windows å¼€å‘è€…æ¨¡å¼
1. æ‰“å¼€ Windows è®¾ç½®
2. è½¬åˆ°"æ›´æ–°å’Œå®‰å…¨" â†’ "å¼€å‘è€…é€‰é¡¹"
3. å¯ç”¨"å¼€å‘è€…æ¨¡å¼"

### 2. Docker æ„å»ºé—®é¢˜

#### ä¾èµ–å†²çªé”™è¯¯
```
npm error ERESOLVE unable to resolve dependency tree
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é¡¹ç›®å·²é…ç½®è‡ªåŠ¨å¤„ç†ï¼Œä½¿ç”¨ `pnpm` ä¼˜å…ˆï¼Œ`npm` å¤‡ç”¨
- å¦‚é‡é—®é¢˜ï¼Œæ£€æŸ¥ `package.json` å’Œ `pnpm-lock.yaml`

#### ç½‘ç»œè¿æ¥è¶…æ—¶
```
Failed to connect to github.com
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ä½¿ç”¨ SSH åè®®
./update2025/setup-ssh.sh

# æˆ–ä½¿ç”¨ç½‘ç»œæ£€æŸ¥å·¥å…·
./update2025/network-check.sh
```

### 3. æœåŠ¡å™¨éƒ¨ç½²é—®é¢˜

#### Git è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
./update2025/network-check.sh

# ä¿®å¤ TLS é—®é¢˜
./update2025/fix-tls.sh

# åˆ‡æ¢åˆ° SSH åè®®
./update2025/switch-to-ssh.sh
```

#### Docker æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ Docker çŠ¶æ€
sudo systemctl status docker

# é‡å¯ Docker æœåŠ¡
sudo systemctl restart docker

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs -f app
```

---

## ğŸ“š ç®¡ç†å‘½ä»¤å‚è€ƒ

### Git æ“ä½œ
```bash
# æŸ¥çœ‹çŠ¶æ€
git status

# æŸ¥çœ‹æäº¤å†å²
git log --oneline

# æ’¤é”€æœ€åä¸€æ¬¡æäº¤ï¼ˆä¿ç•™æ›´æ”¹ï¼‰
git reset --soft HEAD~1

# å¼ºåˆ¶åŒæ­¥è¿œç¨‹åˆ†æ”¯
git reset --hard origin/main
```

### Docker æ“ä½œ
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose logs -f app

# é‡å¯æœåŠ¡
docker-compose restart app

# åœæ­¢æœåŠ¡
docker-compose down

# é‡æ–°æ„å»º
docker-compose up -d --build

# æ¸…ç†èµ„æº
docker image prune -f
docker builder prune -f
```

### ç³»ç»Ÿç›‘æ§
```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
# æˆ–
top

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tulpn | grep :80
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# åº”ç”¨æ—¥å¿—
docker-compose logs -f app

# ç³»ç»Ÿæ—¥å¿—
sudo journalctl -f

# Docker æ—¥å¿—
sudo journalctl -u docker.service
```

---

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

### 1. æœåŠ¡å™¨å®‰å…¨
- å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œè½¯ä»¶åŒ…
- é…ç½®é˜²ç«å¢™è§„åˆ™
- ä½¿ç”¨ SSH å¯†é’¥è®¤è¯
- å®šæœŸå¤‡ä»½é‡è¦æ•°æ®

### 2. åº”ç”¨å®‰å…¨
- ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
- ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†é…ç½®
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…
- ç›‘æ§åº”ç”¨è¿è¡ŒçŠ¶æ€

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- **é¡¹ç›®ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
- **æ›´æ–°æ—¶é—´**: 2025å¹´1æœˆ

### é—®é¢˜åé¦ˆ
å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬
2. Node.js ç‰ˆæœ¬
3. é”™è¯¯ä¿¡æ¯æˆªå›¾
4. æ“ä½œæ­¥éª¤æè¿°

### å‚è€ƒèµ„æº
- [Next.js å®˜æ–¹æ–‡æ¡£](https://nextjs.org/docs)
- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Git å®˜æ–¹æ–‡æ¡£](https://git-scm.com/doc)

---

**æœ€åæ›´æ–°**: 2025å¹´1æœˆ
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0 